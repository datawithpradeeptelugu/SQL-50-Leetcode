CREATE TABLE Insurance (
    pid INT PRIMARY KEY,
    tiv_2015 FLOAT,
    tiv_2016 FLOAT,
    lat FLOAT NOT NULL,
    lon FLOAT NOT NULL
);

INSERT INTO Insurance (pid, tiv_2015, tiv_2016, lat, lon)
VALUES
(1, 10,  5,  10, 10),
(2, 20, 20,  20, 20),
(3, 10, 30,  20, 20),
(4, 10, 40,  40, 40);


SELECT * 
FROM Insurance



WITH PARENT_TABLE
AS
(
SELECT
*,
COUNT(tiv_2015) OVER (PARTITION BY TIV_2015) AS SAME_POLICY_2015,
COUNT(*) OVER (PARTITION BY LAT,LON) AS UNIQUE_CITY
FROM 
Insurance

)
SELECT 
ROUND(SUM(TIV_2016),2) AS tiv_2016
FROM PARENT_TABLE
WHERE 
SAME_POLICY_2015 >1 AND UNIQUE_CITY =1


